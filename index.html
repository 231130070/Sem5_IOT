<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IoT Dashboard</title>

<style>
    body { margin: 0; font-family: Arial; background: #f1f1f1; }
    .page { display: none; padding: 20px; }

    /* LOGIN */
    #loginPage {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-top: 80px;
    }
    #loginBox {
        background: #fff;
        padding: 20px;
        width: 300px;
        border-radius: 10px;
        box-shadow: 0 0 10px #ccc;
    }
    input {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border-radius: 6px;
        border: 1px solid #aaa;
    }
    button {
        width: 100%;
        padding: 12px;
        border: none;
        background: #2b7cff;
        color: #fff;
        margin-top: 10px;
        border-radius: 6px;
        cursor: pointer;
    }

    /* DASHBOARD */
    #dashboardPage { padding: 20px; }
    .card {
        background: white;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 10px;
        box-shadow: 0 0 8px #ccc;
    }
</style>

</head>
<body>

<!-- LOGIN PAGE -->
<div id="loginPage" class="page" style="display:block;">
    <div id="loginBox">
        <h2>Login</h2>
        <input type="text" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button id="loginBtn">Login</button>
        <p id="loginError" style="color:red;"></p>
    </div>
</div>

<!-- DASHBOARD PAGE -->
<div id="dashboardPage" class="page">
    <h2>IoT Sensor Dashboard</h2>

    <div class="card">
        <h3>Soil Moisture:</h3>
        <p id="soilValue">Loading...</p>
    </div>

    <div class="card">
        <h3>Light Level:</h3>
        <p id="lightValue">Loading...</p>
    </div>

    <div class="card">
        <h3>PIR (Motion):</h3>
        <p id="pirValue">Loading...</p>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

<script>
// ===========================
// FIREBASE CONFIG (FINAL, SUDAH SESUAI punyamu)
// ===========================
const firebaseConfig = {
    apiKey: "AIzaSyBL3jO5vXz7Z6VAvzqVvpp0E9qcDJZr3z4",
    authDomain: "internetofthingsmikro.firebaseapp.com",
    databaseURL: "https://internetofthingsmikro-default-rtdb.firebaseio.com",
    projectId: "internetofthingsmikro",
    storageBucket: "internetofthingsmikro.appspot.com",
    messagingSenderId: "78291597447",
    appId: "1:78291597447:web:c2ea3a88e4d4e2a55f844b"
};

firebase.initializeApp(firebaseConfig);

// ===========================
// LOGIN HANDLER
// ===========================
document.getElementById("loginBtn").addEventListener("click", function () {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    firebase.auth().signInWithEmailAndPassword(email, password)
    .then(() => {
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("dashboardPage").style.display = "block";
        loadSensorData();
    })
    .catch(err => {
        document.getElementById("loginError").innerText = err.message;
    });
});

// ===========================
// LOAD SENSOR DATA FROM REALTIME DB
// ===========================
function loadSensorData() {
    const db = firebase.database().ref("sensor");

    db.on("value", snapshot => {
        const data = snapshot.val();
        if (!data) return;

        document.getElementById("soilValue").innerText = data.soil + " %";
        document.getElementById("lightValue").innerText = data.light + " lux";
        document.getElementById("pirValue").innerText = 
            data.pir == 1 ? "Motion Detected" : "No Motion";
    });
}
</script>

</body>
</html>
